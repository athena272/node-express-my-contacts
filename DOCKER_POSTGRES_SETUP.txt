=============================================================================
GUIA PASSO A PASSO: SUBIR IMAGEM DOCKER POSTGRES PARA O PROJETO
=============================================================================

PR√â-REQUISITOS:
- Docker Desktop instalado e rodando no Windows
- Node.js e npm/yarn instalados

=============================================================================
PASSO 1: BAIXAR E RODAR A IMAGEM DO POSTGRES
=============================================================================

1.1. Abra o PowerShell ou CMD como administrador

1.2. Execute o seguinte comando para baixar e rodar o container PostgreSQL:

    docker run --name postgres-mycontacts -e POSTGRES_PASSWORD=root -e POSTGRES_USER=root -e POSTGRES_DB=mycontacts -p 5432:5432 -d postgres:latest

    Explica√ß√£o dos par√¢metros:
    - --name postgres-mycontacts: Define o nome do container
    - -e POSTGRES_PASSWORD=root: Define a senha do usu√°rio root
    - -e POSTGRES_USER=root: Define o usu√°rio como root
    - -e POSTGRES_DB=mycontacts: Cria o banco de dados "mycontacts" automaticamente
    - -p 5432:5432: Mapeia a porta 5432 do container para a porta 5432 do host
    - -d: Roda o container em modo detached (em background)
    - postgres:latest: Usa a vers√£o mais recente do PostgreSQL

1.3. Verifique se o container est√° rodando:

    docker ps

    Voc√™ deve ver o container "postgres-mycontacts" na lista

=============================================================================
PASSO 2: VERIFICAR CONECTIVIDADE (OPCIONAL)
=============================================================================

2.1. Teste a conex√£o executando um comando dentro do container:

    docker exec -it postgres-mycontacts psql -U root -d mycontacts

2.2. Se conectou com sucesso, voc√™ ver√° o prompt do psql. Digite:

    \dt

    (para listar as tabelas - inicialmente vazio)

    \q

    (para sair)

=============================================================================
PASSO 3: CRIAR AS TABELAS DO BANCO DE DADOS
=============================================================================

Voc√™ tem 3 op√ß√µes para criar as tabelas:

OP√á√ÉO A - Usando docker exec (RECOMENDADO):
-------------------------------------------
3.1. Execute o arquivo schema.sql diretamente no container:

    docker exec -i postgres-mycontacts psql -U root -d mycontacts < src/database/schema.sql

3.2. Verifique se as tabelas foram criadas:

    docker exec -it postgres-mycontacts psql -U root -d mycontacts -c "\dt"

    Voc√™ deve ver duas tabelas: categories e contacts

OP√á√ÉO B - Copiando o arquivo para o container:
-----------------------------------------------
3.1. Copie o arquivo schema.sql para dentro do container:

    docker cp src/database/schema.sql postgres-mycontacts:/tmp/schema.sql

3.2. Execute o script dentro do container:

    docker exec -i postgres-mycontacts psql -U root -d mycontacts -f /tmp/schema.sql

OP√á√ÉO C - Entrando interativamente no container:
------------------------------------------------
3.1. Entre no container:

    docker exec -it postgres-mycontacts psql -U root -d mycontacts

3.2. Cole o conte√∫do do arquivo schema.sql linha por linha ou:

    \i /tmp/schema.sql

    (ap√≥s copiar o arquivo usando a Op√ß√£o B, passo 3.1)

=============================================================================
PASSO 4: VERIFICAR SE AS TABELAS FORAM CRIADAS
=============================================================================

4.1. Execute o seguinte comando:

    docker exec -it postgres-mycontacts psql -U root -d mycontacts -c "\d categories"

    docker exec -it postgres-mycontacts psql -U root -d mycontacts -c "\d contacts"

4.2. Voc√™ deve ver a estrutura das tabelas com suas colunas e tipos

=============================================================================
PASSO 5: CONFIGURAR E RODAR O PROJETO NODE.JS
=============================================================================

5.1. Instale as depend√™ncias (se ainda n√£o fez):

    npm install
    ou
    yarn install

5.2. Verifique se o arquivo src/database/index.js est√° configurado corretamente:
    - host: 'localhost'
    - port: 5432
    - user: 'root'
    - password: 'root'
    - database: 'mycontacts'

5.3. Inicie o servidor:

    npm run dev
    ou
    yarn dev

5.4. Voc√™ deve ver a mensagem: "üî• Connected to database üî•"
    E depois: "üî• Server on fire üî• at http://localhost:3000"

=============================================================================
COMANDOS √öTEIS PARA GERENCIAR O CONTAINER
=============================================================================

PARAR o container:
    docker stop postgres-mycontacts

INICIAR o container (se j√° existe):
    docker start postgres-mycontacts

REINICIAR o container:
    docker restart postgres-mycontacts

VER LOGS do container:
    docker logs postgres-mycontacts

REMOVER o container (CUIDADO: apaga todos os dados):
    docker stop postgres-mycontacts
    docker rm postgres-mycontacts

LISTAR todos os containers (incluindo parados):
    docker ps -a

=============================================================================
ESTRUTURA DO SCHEMA.SQL
=============================================================================

O arquivo schema.sql cria:

1. DATABASE: mycontacts
   - Cria o banco de dados (j√° criado automaticamente pelo Docker)

2. EXTENSION: uuid-ossp
   - Permite gerar UUIDs automaticamente

3. TABELA: categories
   - id: UUID (chave prim√°ria, gerado automaticamente)
   - name: VARCHAR (nome da categoria)

4. TABELA: contacts
   - id: UUID (chave prim√°ria, gerado automaticamente)
   - name: VARCHAR (nome do contato)
   - email: VARCHAR UNIQUE (email √∫nico)
   - phone: VARCHAR (telefone)
   - category_id: UUID (chave estrangeira referenciando categories.id)

A rela√ß√£o √©: Um contato pode ter uma categoria (category_id pode ser NULL)

=============================================================================
RESOLU√á√ÉO DE PROBLEMAS COMUNS
=============================================================================

ERRO: "port 5432 is already allocated"
SOLU√á√ÉO: Outro PostgreSQL est√° rodando na porta 5432
- Use outra porta: -p 5433:5432 (e atualize src/database/index.js)
- Ou pare o PostgreSQL local que est√° rodando

ERRO: "password authentication failed"
SOLU√á√ÉO: Verifique se as credenciais em src/database/index.js
         correspondem √†s definidas no comando docker run

ERRO: "database does not exist"
SOLU√á√ÉO: Execute o schema.sql novamente ou verifique se o
         banco foi criado corretamente

ERRO: "could not connect to server"
SOLU√á√ÉO: Verifique se o container est√° rodando: docker ps
         Se n√£o estiver: docker start postgres-mycontacts

=============================================================================
OBSERVA√á√ïES IMPORTANTES
=============================================================================

‚ö†Ô∏è Os dados no container ser√£o perdidos se voc√™ remover o container
   Para persistir dados, use volumes do Docker (pesquise sobre docker volumes)

‚ö†Ô∏è As credenciais usadas (root/root) s√£o apenas para desenvolvimento
   Em produ√ß√£o, use credenciais seguras e vari√°veis de ambiente

=============================================================================

